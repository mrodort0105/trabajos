import re
import sys

# --- Definición de Datos y Colores ---

matriz = [[1, "manzanas", 5], [2, "Platanos", 7], [3, "Sandia", 2], [4, "Kiwi", 4], [5, "Tomate", 8]]
COLOR_ROJO = "\033[91m"
COLOR_VERDE = "\033[92m"
COLOR_AMARILLO = "\033[93m"
COLOR_AZUL = "\033[94m"
COLOR_RESET = "\033[0m"

# --- Funciones de Inventario ---

def buscar_id_producto(matriz_productos):
    """Permite buscar un producto por su ID en la matriz."""
    print("\n" + "=" * 50)
    print(f"  {COLOR_AZUL}BUSCADOR DE PRODUCTO POR ID{COLOR_RESET}")
    print("=" * 50)

    try:
        id_producto = int(input("Que ID del producto buscas.. "))
    except ValueError:
        print(f"\n{COLOR_ROJO} ERROR: La entrada debe ser un número entero para el ID.{COLOR_RESET}\n")
        return

    producto_encontrado_datos = None
    
    # Búsqueda real del ID
    for p in matriz_productos:
        if p[0] == id_producto:
            producto_encontrado_datos = p
            break
            
    if producto_encontrado_datos is not None:
        nombre = producto_encontrado_datos[1]
        stock = producto_encontrado_datos[2]
        print("\n--- Producto Encontrado ---")
        print(f"ID:    **{id_producto}**")
        print(f"Nombre: **{nombre}**")
        print(f"Stock:  **{stock}** unidades")
        print("--------------------------\n")
        
    else:
        print(f"\n{COLOR_ROJO} ERROR: Producto con ID {id_producto} no encontrado.{COLOR_RESET}\n")

def comparar_stock(matriz_productos):
    """Compara el stock para encontrar el producto con el máximo y el mínimo."""
    if not matriz_productos:
        print(f"{COLOR_AMARILLO}El inventario está vacío.{COLOR_RESET}")
        return
        
    # Inicializar con el primer producto
    max_stock_productos = matriz_productos[0]
    min_stock_productos = matriz_productos[0]
    
    for producto in matriz_productos:
        stock_actual = producto[2]
        
        if stock_actual > max_stock_productos[2]:
            max_stock_productos = producto
            
        if stock_actual < min_stock_productos[2]:
            min_stock_productos = producto
                
    print("-" * 50)
    print(f"{COLOR_VERDE}RESUMEN DE INVENTARIO{COLOR_RESET}")
    print("-" * 50)
    
    # Stock Máximo
    nombre_max = max_stock_productos[1]
    stock_max = max_stock_productos[2]

    print(f"{COLOR_VERDE}Stock Más Alto:{COLOR_RESET}")
    print(f" Producto: {nombre_max}")
    print(f" Stock: {stock_max} unidades")

    # Stock Mínimo
    nombre_min = min_stock_productos[1]
    stock_min = min_stock_productos[2]
    
    print("-" * 50)
    print(f"\n{COLOR_ROJO}Stock mas bajo:{COLOR_RESET}\n")
    print(f"  Producto: **{nombre_min}**")
    print(f"  Stock:    **{stock_min}** unidades")
    print("-" * 50)

def validar_nombre_producto():
    """Valida un nuevo nombre de producto usando expresiones regulares."""
    print("\n" + "=" * 50)
    print(f"  {COLOR_AZUL}VALIDACIÓN DE NUEVO NOMBRE DE PRODUCTO (RegEx){COLOR_RESET}")
    print("=" * 50)
    
    nombre_producto = input("Introduce un nuevo nombre de producto: ").strip()
    
    # Patrones para las reglas de validación
    patron_mayuscula = r"^[A-Z]"  # Debe empezar con una letra mayúscula
    patron_digito = r"\d"         # Debe contener al menos un dígito
    
    errores = []

    # 1. Validación de Mayúscula al inicio
    if not re.search(patron_mayuscula, nombre_producto):
        errores.append(" - No empieza por letra mayúscula (A-Z).")
        
    # 2. Validación de Contiene al menos un dígito
    if not re.search(patron_digito, nombre_producto):
        errores.append(" - No contiene al menos un dígito (0-9).")
        
    # 3. Validación de Longitud (5 a 20 caracteres)
    longitud = len(nombre_producto)
    if not (5 <= longitud <= 20):
        errores.append(f" - La longitud es {longitud} caracteres, debe ser de 5 a 20 caracteres.")

    # --- Resultado de la Validación ---
    
    if not errores:
        # Válido
        print("\n" + "*" * 50)
        print(f"{COLOR_VERDE}VALIDACIÓN EXITOSA:{COLOR_RESET}")
        print(f"  Nombre del Producto: **{nombre_producto}**")
        print("*" * 50 + "\n")
    else:
        # Inválido
        print("\n" + "-" * 50)
        print(f"{COLOR_ROJO}VALIDACIÓN FALLIDA:{COLOR_RESET}")
        print(f"  Nombre ingresado: **{nombre_producto}**")
        print("  Razones del fallo:")
        for error in errores:
            print(f"    {error}")
        print("-" * 50 + "\n")

# --- Menú Principal ---

def menu_principal():
    """Muestra el menú de opciones e invoca a las funciones seleccionadas."""
    while True:
        print("\n" + "*" * 50)
        print(f"{COLOR_AMARILLO}  SISTEMA DE GESTIÓN DE INVENTARIO (Python){COLOR_RESET}")
        print("*" * 50)
        print(f"1. {COLOR_VERDE}Ver Resumen de Stock (Máx/Mín){COLOR_RESET}")
        print(f"2. {COLOR_VERDE}Buscar Producto por ID{COLOR_RESET}")
        print(f"3. {COLOR_VERDE}Validar Nuevo Nombre de Producto (RegEx){COLOR_RESET}")
        print(f"4. {COLOR_ROJO}Salir{COLOR_RESET}")
        print("-" * 50)
        
        opcion = input("Selecciona una opción (1-4): ")
        
        print("\n")
        
        if opcion == '1':
            comparar_stock(matriz)
        elif opcion == '2':
            buscar_id_producto(matriz)
        elif opcion == '3':
            validar_nombre_producto()
        elif opcion == '4':
            print(f"{COLOR_AZUL}Gracias por usar el sistema. Saliendo...{COLOR_RESET}")
            sys.exit() # Salir del programa
        else:
            print(f"{COLOR_ROJO}Opción no válida. Por favor, selecciona un número entre 1 y 4.{COLOR_RESET}")

# --- Ejecución del Programa ---

if __name__ == "__main__":
    menu_principal()
